<alfresco-config>

	<!-- 
	**** 
	creación de nuevos tipos desde la librería de documentos. 
	**** 
	-->
	<config evaluator="string-compare" condition="DocumentLibrary">
		<create-content>
			<content id="plain-text" mimetype="text/plain" label="Registro PAUs"
				itemid="pau:contenedorPAUs" icon="folder" />
			<content id="plain-text" mimetype="text/plain" label="PAU"
				itemid="pau:PAU" icon="folder" />
			<content id="plain-text" mimetype="text/plain" label="Libro de Registro"
				itemid="pau:contenedorAsientos" icon="folder" />
			<content id="plain-text" mimetype="text/plain" label="Asiento Registral"
				itemid="pau:asientoRegistral" icon="folder" />
		</create-content>
	</config>

	<!-- 
	**** 
	FORMULARIOS DE TIPOS DE CONTENIDO Y ASPECTOS 
	**** 
	-->
	<!-- Tipo PAU -->
	<!-- Para nodos nuevos -->
	<config evaluator="model-type" condition="pau:PAU">
		<forms>
			<form>
				<field-visibility>
					<show id="cm:name" />
					<show id="cm:title" force="true" />
					<show id="pau:estado" />
					<show id="pau:numeroPAU" />
					<show id="pau:localidadPAU" />
					<show id="pau:AUIUrbanizador" />
					<show id="pau:CIFAUI" />
					<show id="pau:fechaInformePrevio" />
					<show id="pau:fechaAprobacionPleno" />
					<show id="pau:fechaInscripcion" />
					<show id="pau:superficie" />
					<show id="pau:uso" />
					<show id="pau:numeroViviendas" />
				</field-visibility>
				<appearance>
					<field id="cm:name" label="Nombre" />
					<field id="cm:title" label="Denominación" description="Denominación del PAU" />

					<set id="datos1" appearance="bordered-panel" label="Datos"
						template="/org/alfresco/components/form/2-column-set.ftl" />
					<field id="pau:numeroPAU" label="Número de PAU" set="datos1" />
					<field id="pau:superficie" label="Superficie" set="datos1" />
					<field id="pau:localidadPAU" label="Localidad" set="datos1" />
					<field id="pau:uso" label="Uso" set="datos1" />
					<field id="pau:numeroViviendas" label="Número de Viviendas"
						set="datos1" />

					<set id="AUI" appearance="bordered-panel" label="AUI o Urbanizador"
						template="/org/alfresco/components/form/2-column-set.ftl" />
					<field id="pau:AUIUrbanizador" label="AUI o Urbanizador" set="AUI" />
					<field id="pau:CIFAUI" label="CIF" set="AUI" />

					<set id="fechas" appearance="bordered-panel" label="Fechas"
						template="/org/alfresco/components/form/3-column-set.ftl" />
					<field id="pau:fechaInformePrevio" set="fechas" />
					<field id="pau:fechaAprobacionPleno" set="fechas" />
					<field id="pau:fechaInscripcion" set="fechas" />
					<field id="pau:estado" label="Estado" />
				</appearance>
			</form>
		</forms>
	</config>

	<!-- Tipo PAU -->
	<!-- Para nodos existentes -->
	<config evaluator="node-type" condition="pau:PAU">
		<forms>
			<form>
				<field-visibility>
					<show id="cm:name" />
					<show id="cm:title" force="true" />
					<show id="pau:estado" />
					<show id="pau:numeroPAU" />
					<show id="pau:localidadPAU" />
					<show id="pau:AUIUrbanizador" />
					<show id="pau:CIFAUI" />
					<show id="pau:fechaInformePrevio" />
					<show id="pau:fechaAprobacionPleno" />
					<show id="pau:fechaInscripcion" />
					<show id="pau:superficie" />
					<show id="pau:uso" />
					<show id="pau:numeroViviendas" />
				</field-visibility>
				<appearance>
					<field id="cm:name" label="Nombre" />
					<field id="cm:title" label="Denominación" description="Denominación del PAU" />

					<set id="datos1" appearance="bordered-panel" label="Datos"
						template="/org/alfresco/components/form/2-column-set.ftl" />
					<field id="pau:numeroPAU" label="Número de PAU" set="datos1" />
					<field id="pau:superficie" label="Superficie" set="datos1" />
					<field id="pau:localidadPAU" label="Localidad" set="datos1" />
					<field id="pau:uso" label="Uso" set="datos1" />
					<field id="pau:numeroViviendas" label="Número de Viviendas"
						set="datos1" />

					<set id="AUI" appearance="bordered-panel" label="AUI o Urbanizador"
						template="/org/alfresco/components/form/2-column-set.ftl" />
					<field id="pau:AUIUrbanizador" label="AUI o Urbanizador" set="AUI" />
					<field id="pau:CIFAUI" label="CIF" set="AUI" />

					<set id="fechas" appearance="bordered-panel" label="Fechas"
						template="/org/alfresco/components/form/3-column-set.ftl" />
					<field id="pau:fechaInformePrevio" set="fechas" />
					<field id="pau:fechaAprobacionPleno" set="fechas" />
					<field id="pau:fechaInscripcion" set="fechas" />
					<field id="pau:estado" label="Estado" />
				</appearance>
			</form>
		</forms>
	</config>

	<!-- Tipo Asiento Registral -->
	<!-- Para nodos nuevos -->
	<config evaluator="model-type" condition="pau:asientoRegistral">
		<forms>
			<form>
				<field-visibility>
					<show id="cm:name" />
					<show id="cm:content" />
					<show id="pau:fechaAsiento" />
					<show id="pau:tipoAsiento" />
					<show id="pau:pauAsociadoAsiento" />
				</field-visibility>
				<appearance>
					<field id="cm:name" label="Nombre" />
					<field id="cm:content" label="Contenido" description="Contenido del asiento" />
					<set id="datos1" appearance="bordered-panel" label="Datos"
						template="/org/alfresco/components/form/2-column-set.ftl" />
					<field id="pau:fechaAsiento" label="Fecha" set="datos1" />
					<field id="pau:tipoAsiento" label="Tipo de Asiento" set="datos1" />
					<field id="pau:pauAsociadoAsiento" label="PAU asociado">
						<control template="/org/alfresco/components/form/controls/association.ftl">
							<control-param name="startLocation">{doclib}</control-param>
							<control-param name="compactMode">false</control-param>
							<control-param name="displayMode">list</control-param>
						</control>
					</field>
				</appearance>
			</form>
		</forms>
	</config>

	<!-- Tipo Asiento Registral -->
	<!-- Para nodos existentes -->
	<config evaluator="node-type" condition="pau:asientoRegistral">
		<forms>
			<form>
				<field-visibility>
					<show id="cm:name" />
					<show id="cm:content" />
					<show id="pau:fechaAsiento" />
					<show id="pau:tipoAsiento" />
					<show id="pau:pauAsociadoAsiento" />
				</field-visibility>
				<appearance>
					<field id="cm:name" label="Nombre" />
					<field id="cm:content" label="Contenido" description="Contenido del asiento" />
					<set id="datos1" appearance="bordered-panel" label="Datos"
						template="/org/alfresco/components/form/2-column-set.ftl" />
					<field id="pau:fechaAsiento" label="Fecha" set="datos1" />
					<field id="pau:tipoAsiento" label="Tipo de Asiento" set="datos1" />
					<field id="pau:pauAsociadoAsiento" label="PAU asociado">
						<control template="/org/alfresco/components/form/controls/association.ftl">
							<control-param name="startLocation">{doclib}</control-param>
							<control-param name="compactMode">false</control-param>
							<control-param name="displayMode">list</control-param>
						</control>
					</field>
				</appearance>
			</form>
		</forms>
	</config>

	<!-- 
	Formularios de aspectos
	 -->
	 <config evaluator="aspect" condition="pau:registradoUnico">
		<forms>
			<form>
				<field-visibility>
					<show id="pau:fechaRegistro" />
					<show id="pau:numRegistro" />
				</field-visibility>
				<appearance>
					<set id="registroUnico" appearance="bordered-panel" label="Registro Único"
						template="/org/alfresco/components/form/2-column-set.ftl" />
					<field id="pau:numRegistro" label="Numero de Registro" set="registroUnico"/>
					<field id="pau:fechaRegistro" label="Fecha de Registro" description="Fecha de Registro" set="registroUnico">
						<control template="/org/alfresco/components/form/controls/date.ftl">
                  			<control-param name="showTime">false</control-param>
               			</control>
					</field>
				</appearance>
			</form>
		</forms>
	</config>



	<!-- 
	Formularios de acciones
	 -->
	<!-- Formulario para la acción de creación de PAU -->
	<config evaluator="string-compare" condition="createPAU_Dialogo_Action">
		<forms>
			<form>
				<field-visibility>
					<show id="nombrePAU" />
					<show id="descripcion" />
				</field-visibility>
				<appearance>
					<field id="nombrePAU" label="Nombre" />
					<field id="descripcion" label="Denominación" description="Denominación del PAU" />
				</appearance>
			</form>
		</forms>
	</config>
	
	<!-- Formulario para la acción de añadir registro único -->
	<config evaluator="string-compare" condition="addRegistradoUnico_Dialogo_Action">
		<forms>
			<form>
				<field-visibility>
					<show id="fechaRegistro" />
					<show id="numRegistro" />
				</field-visibility>
				<appearance>
					<field id="numRegistro" label="Numero de Registro" />
					<field id="fechaRegistro" label="Fecha de Registro" description="Fecha de Registro" >
						<control template="/org/alfresco/components/form/controls/date.ftl">
                  			<control-param name="showTime">false</control-param>
               			</control>
					</field>
				</appearance>
			</form>
		</forms>
	</config>
	
	<!-- Formulario para la acción de enviar documento por mail -->
	<config evaluator="string-compare" condition="sendDocumentByMail_Action">
		<forms>
			<form>
				<field-visibility>
					<show id="to" />
					<show id="subject" />
					<show id="body" />
				</field-visibility>
				<appearance>
					<field id="to" label="Para" />
					<field id="subject" label="Asunto" />
					<field id="body" label="Contenido" />
				</appearance>
			</form>
		</forms>
	</config>

	<!-- 
	**** 
	ACCIONES DE LA LIBRERÍA 
	**** 
	-->
	<config evaluator="string-compare" condition="DocLibActions">
		<actions>
			<!-- Creación de un PAU -->
			<!-- <action id="createPAU" type="javascript" label="actions.pau.createpausimple"> -->
			<!-- <param name="function">onActionSimpleRepoAction</param> -->
			<!-- <permissions> -->
			<!-- <permission allow="true">Write</permission> -->
			<!-- </permissions> -->
			<!-- <param name="action">createPAU_Action</param> -->
			<!-- <param name="successMessage">message.createpau.success</param> -->
			<!-- <param name="failureMessage">message.createpau.failure</param> -->
			<!-- </action> -->

			<!-- Creación de un PAU con diálogo ver: http://ecmstuff.blogspot.com.es/2012/04/adding-document-library-actions-in.html 
				http://www.slideshare.net/alfresco/alfresco-tech-talk-live-share-extensibility-metadata-and-actions-for-41 -->
			<action id="createPAU_Dialog" type="javascript" label="actions.pau.createpau">
				<param name="function">onActionFormDialog</param>
				<param name="itemKind">action</param>
				<param name="itemId">createPAU_Dialogo_Action</param>
				<param name="mode">create</param>
				<param name="destination">{node.nodeRef}</param>
				<evaluator>evaluator.fom.pau.contenedorPAUsType</evaluator>
				<permissions>
					<permission allow="true">Write</permission>
				</permissions>
				<param name="successMessage">message.createpau.success</param>
				<param name="failureMessage">message.createpau.failure</param>
			</action>
			
			<!-- Añadir el aspecto registradoUnico mediante una acción de diálogo -->			
			<action id="addRegistradoUnico_Dialog" type="javascript" label="actions.pau.add_registradounico">
				<param name="function">onActionFormDialog</param>
				<param name="itemKind">action</param>
				<param name="itemId">addRegistradoUnico_Dialogo_Action</param>
				<param name="mode">create</param>
				<param name="destination">{node.nodeRef}</param>
				<evaluator negate="true">evaluator.fom.pau.registradoUnicoAspecto</evaluator>
				<evaluator>evaluator.fom.pau.pauSite</evaluator>
				<!-- Se comenta este evaluador ya que no comprueba de manera recursiva hacie arriba. 
				Es decir, sólo es verdadero en el caso en que el nodo sea hijo directo de un contenedor de PAUs				
				<evaluator>evaluator.fom.pau.contenedorPAUs</evaluator> 
				-->
				<permissions>
					<permission allow="true">Write</permission>
				</permissions>
				<param name="successMessage">message.add_registradounico.success</param>
				<param name="failureMessage">message.add_registradounico.failure</param>
			</action>
			
			<!-- Envio del documento por mail -->
			<action id="sendDocumentByMail_Action" type="javascript" label="actions.pau.senddocumentbymail">
				<param name="function">onActionFormDialog</param>
				<param name="itemKind">action</param>
				<param name="itemId">sendDocumentByMail_Action</param>
				<param name="mode">create</param>
				<param name="destination">{node.nodeRef}</param>
<!-- 				<evaluator negate="true">evaluator.fom.pau.registradoUnicoAspecto</evaluator> -->
<!-- 				<evaluator>evaluator.fom.pau.pauSite</evaluator> -->
				<!-- Se comenta este evaluador ya que no comprueba de manera recursiva hacie arriba. 
				Es decir, sólo es verdadero en el caso en que el nodo sea hijo directo de un contenedor de PAUs				
				<evaluator>evaluator.fom.pau.contenedorPAUs</evaluator> 
				-->
<!-- 				<permissions> -->
<!-- 					<permission allow="true">Write</permission> -->
<!-- 				</permissions> -->
				<param name="successMessage">message.senddocumentbymail.success</param>
				<param name="failureMessage">message.senddocumentbymail.failure</param>
			</action>
		</actions>
		

		<actionGroups>
			<actionGroup id="document-browse">
				<action index="500" id="addRegistradoUnico_Dialog" />
				<action index="501" id="sendDocumentByMail_Action" />
			</actionGroup>"
			
			<actionGroup id="folder-browse">
<!-- 				<action index="500" id="createPAU" /> -->
				<action index="501" id="createPAU_Dialog" />
			</actionGroup>
		</actionGroups>
	</config>


	<!-- 
	**** 
	METADATA TEMPLATES 
	**** 
	-->
	<config evaluator="string-compare" condition="DocumentLibrary">
		<metadata-templates>
			<template id="asientosRegistrales">
				<evaluator>evaluator.fom.pau.asientoRegistralType</evaluator>
				<line index="10" id="fechaAsiento">{pau_fechaAsiento}</line>
				<line index="20" id="tipoAsiento">{pau_tipoAsiento}</line>
				<line index="30" id="Texto">{pau_resumenAsiento}</line>
			</template>

		</metadata-templates>
	</config>

</alfresco-config>